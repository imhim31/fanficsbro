<!DOCTYPE html>
<html>
<head>
    <title>Kindle HTML Generator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .container {
            display: flex;
            gap: 20px;
        }
        .left-panel {
            flex: 1;
        }
        .right-panel {
            flex: 1;
        }
        textarea {
            width: 100%;
            height: 500px;
            font-family: monospace;
            font-size: 12px;
        }
        button {
            padding: 10px 20px;
            margin: 10px 0;
            background: #007cba;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .preview {
            border: 1px solid #ccc;
            padding: 10px;
            height: 500px;
            overflow: auto;
        }
    </style>
</head>
<body>
    <h1>Kindle Static HTML Generator</h1>
    
    <div class="container">
        <div class="left-panel">
            <button onclick="generateHTML()">Generate Static HTML from Firebase</button>
            <textarea id="htmlOutput" placeholder="Generated HTML will appear here..."></textarea>
            <button onclick="copyToClipboard()">Copy HTML to Clipboard</button>
        </div>
        
        <div class="right-panel">
            <h3>Preview:</h3>
            <div class="preview" id="preview"></div>
        </div>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDLmVWE3eIbHFqqnpN5bGygjZUf8kB5HeE",
            authDomain: "fanfics-2f495.firebaseapp.com",
            projectId: "fanfics-2f495",
            storageBucket: "fanfics-2f495.firebasestorage.app",
            messagingSenderId: "634198499413",
            appId: "1:634198499413:web:fa1bb662798a35e70934dc"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const emojiMap = {
            "star": "https://cdn.glitch.global/381f1ea9-3b68-4215-8c0b-5811be8e5192/a.gif",
            "nerd": "https://cdn.glitch.global/381f1ea9-3b68-4215-8c0b-5811be8e5192/8500-toro-nerd.gif?v=1731489114587",
            "catnono": "https://cdn.glitch.global/381f1ea9-3b68-4215-8c0b-5811be8e5192/3258-toro-big-nono.gif?v=1731489079862",
            "catdancing": "https://cdn.glitch.global/381f1ea9-3b68-4215-8c0b-5811be8e5192/1299-toro-cat-danceheart.gif?v=1731489096338",
            "catangry": "https://cdn.glitch.global/381f1ea9-3b68-4215-8c0b-5811be8e5192/8500-toro-superangry.gif?v=1731489117693",
            "bearkiss": "https://cdn.glitch.global/381f1ea9-3b68-4215-8c0b-5811be8e5192/3155-pastelbear-kiss.gif?v=1731489101861",
            "beareat": "https://cdn.glitch.global/381f1ea9-3b68-4215-8c0b-5811be8e5192/3609-pastelbear-eat.gif?v=1731489109327",
            "teddybear": "https://cdn.glitch.global/381f1ea9-3b68-4215-8c0b-5811be8e5192/97835-teddybear.png?v=1731489181476",
            "kirbyyay": "https://cdn.glitch.global/381f1ea9-3b68-4215-8c0b-5811be8e5192/14220-kirbyyay.gif?v=1731489121227",
            "kirbyyes": "https://cdn.glitch.global/381f1ea9-3b68-4215-8c0b-5811be8e5192/26459-kirbyyes.gif?v=1731489125073",
            "proud": "https://cdn.glitch.global/381f1ea9-3b68-4215-8c0b-5811be8e5192/33701-tiktokproud.png?v=1731489173601",
            "happy": "https://cdn.glitch.global/381f1ea9-3b68-4215-8c0b-5811be8e5192/8194-tt-happy.png?v=1731489157323",
            "ttflushed": "https://cdn.glitch.global/381f1ea9-3b68-4215-8c0b-5811be8e5192/1514-tt-flushed.png?v=1731489129181",
            "ttthumbsup": "https://cdn.glitch.global/381f1ea9-3b68-4215-8c0b-5811be8e5192/1662-tt-thumbs-up.png?v=1731489131217",
            "ttannoyed": "https://cdn.glitch.global/381f1ea9-3b68-4215-8c0b-5811be8e5192/2489-tt-annoyed.png?v=1731489135623",
            "ttangry": "https://cdn.glitch.global/381f1ea9-3b68-4215-8c0b-5811be8e5192/3887-tt-angry.png?v=1731489138960",
            "ttdrool": "https://cdn.glitch.global/381f1ea9-3b68-4215-8c0b-5811be8e5192/6754-tt-drool.png?v=1731489142879",
            "ttsulk": "https://cdn.glitch.global/381f1ea9-3b68-4215-8c0b-5811be8e5192/7290-tt-sulk.png?v=1731489145336",
            "ttrollingeyes": "https://cdn.glitch.global/381f1ea9-3b68-4215-8c0b-5811be8e5192/7576-tt-rolling-eyes.png?v=1731489151338",
            "ttthinking": "https://cdn.glitch.global/381f1ea9-3b68-4215-8c0b-5811be8e5192/8082-tt-thinking.png?v=1731489153708",
            "ttweep": "https://cdn.glitch.global/381f1ea9-3b68-4215-8c0b-5811be8e5192/8743-tt-weep.png?v=1731489160109",
            "ttshy": "https://cdn.glitch.global/381f1ea9-3b68-4215-8c0b-5811be8e5192/8812-tt-shy.png?v=1731489163671",
            "ttsobbing": "https://cdn.glitch.global/381f1ea9-3b68-4215-8c0b-5811be8e5192/10529-tt-sobbing.png?v=1731489166715",
            "ttuhuh": "https://cdn.glitch.global/381f1ea9-3b68-4215-8c0b-5811be8e5192/39582-uhuh.png?v=1731489177292",
            "ttheh": "https://cdn.glitch.global/381f1ea9-3b68-4215-8c0b-5811be8e5192/30920-heh.png?v=1731489171141"
        };

        async function generateHTML() {
            try {
                const snapshot = await db.collection('entries').orderBy('createdAt').get();
                const entriesByCategory = {
                    canReadAgain: [],
                    shorties: [],
                    notWorthReading: []
                };

                snapshot.forEach(doc => {
                    const entry = doc.data();
                    if (entry.category && entriesByCategory[entry.category]) {
                        entriesByCategory[entry.category].push(entry);
                    }
                });

                // Generate the HTML content for each section
                const canReadAgainHTML = generateSectionHTML(entriesByCategory.canReadAgain);
                const shortiesHTML = generateSectionHTML(entriesByCategory.shorties);
                const notWorthReadingHTML = generateSectionHTML(entriesByCategory.notWorthReading);

                const fullHTML = `<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
  <title>Fanfics</title>
  <link rel="icon" href="https://cdn.glitch.global/381f1ea9-3b68-4215-8c0b-5811be8e5192/a.PNG?v=1731478429002" type="image/icon type">
  
  <style>
    /* Simplified CSS for Kindle compatibility */
    body {
      background-color: #ff9ed4;
      margin: 0;
      padding: 10px;
      font-family: Arial, sans-serif;
      font-size: 18px;
      line-height: 1.5;
    }

    .background {
      background-color: #f74dab;
      color: white;
      border: 2px dashed white;
      padding: 15px;
      margin: 10px 0;
    }

    .h1background {
      background-color: #f74dab;
      color: white;
      padding: 10px;
      margin: 20px 0 10px 0;
    }

    a {
      color: white;
      text-decoration: underline;
      padding: 2px 5px;
      margin: 0 2px;
    }

    a[target="_blank"] {
      background-color: rgba(255, 255, 255, 0.3);
      border-radius: 3px;
    }

    button {
      background-color: #ff8f0f;
      border: 2px solid #f74dab;
      font-size: 20px;
      padding: 10px;
      margin: 5px;
      color: white;
    }

    .footer {
      text-align: center;
      margin: 20px 0;
    }

    .footer img {
      width: 30%;
      height: auto;
      margin: 0 5px;
    }

    .xd {
      height: 19px;
      vertical-align: middle;
    }

    .loading {
      text-align: center;
      padding: 20px;
    }
  </style>
</head>

<body>

<h1 class="h1background">Can read again</h1>
<div class="background" id="canReadAgain">
${canReadAgainHTML}
</div>
  
<br>
<h1 class="h1background">Shorties</h1>
<div class="background" id="shorties">
${shortiesHTML}
</div>

<br>
<h1 class="h1background">Not rlly worth reading again</h1>
<div class="background" id="notWorthReading">
${notWorthReadingHTML}
</div>

<br>
<h1 class="h1background">Add a New Entry</h1>
<div class="background">
  <p><em>Note: Adding new entries is disabled on Kindle. Use a regular browser to add entries.</em></p>
</div>

<div style="text-align: center;">
  <button onclick="window.location.href='/fanficsbro/emojis.html'">Emojis</button>
  <button onclick="window.location.href='/fanficsbro/comments.html'">Comments</button>
</div>

<br>
<div class="footer">
  <img src="https://cdn.glitch.global/381f1ea9-3b68-4215-8c0b-5811be8e5192/b.png?v=1731478434939" alt="">
  <img src="https://cdn.glitch.global/381f1ea9-3b68-4215-8c0b-5811be8e5192/b.png?v=1731478434939" alt="">
  <img src="https://cdn.glitch.global/381f1ea9-3b68-4215-8c0b-5811be8e5192/b.png?v=1731478434939" alt="">
</div>

<script>
// Simple static emoji replacement for any hardcoded content
function replaceStaticEmojis() {
  const staticEmojiMap = ${JSON.stringify(emojiMap, null, 2)};
  
  const emojiSpans = document.querySelectorAll('.emoji');
  emojiSpans.forEach(span => {
    const emojiName = span.textContent.trim();
    if (staticEmojiMap[emojiName]) {
      span.outerHTML = \`<img class="xd" src="\${staticEmojiMap[emojiName]}" alt="\${emojiName}">\`;
    }
  });
}

// Run static emoji replacement
document.addEventListener('DOMContentLoaded', replaceStaticEmojis);
</script>

</body>
</html>`;

                document.getElementById('htmlOutput').value = fullHTML;
                document.getElementById('preview').innerHTML = fullHTML;

            } catch (error) {
                console.error('Error generating HTML:', error);
                document.getElementById('htmlOutput').value = 'Error: ' + error.message;
            }
        }

        function generateSectionHTML(entries) {
            if (!entries || entries.length === 0) {
                return '<p>No entries in this category.</p>';
            }

            return entries.map(entry => {
                const starImg = `<a class="emoji">star</a>`;
                const linkPart = entry.link ? 
                    `${starImg}<a target="_blank" href="${entry.link}">link</a>${starImg}` : '';
                
                return `-${entry.title} (${entry.description}) ${linkPart}<br>`;
            }).join('\n');
        }

        function copyToClipboard() {
            const textarea = document.getElementById('htmlOutput');
            textarea.select();
            document.execCommand('copy');
            alert('HTML copied to clipboard!');
        }
    </script>
</body>
</html>
